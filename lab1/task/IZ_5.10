  
USE Sypachov
DECLARE @Group VARCHAR(40)
DECLARE @TOP_STUDENTS TABLE (fio VARCHAR(40), res INT)
DECLARE @fio VARCHAR(40), @res INT, @Gr VARCHAR(40)
DECLARE @n INT, @Counter INT
SET @n = 0
SET @Group = 'ИДБ-17-07'
DECLARE mark_cursor CURSOR SCROLL LOCAL STATIC
    FOR SELECT DISTINCT Student.FIO, Student.NameGroup, AVG(Exam.mark) as avg_mark
FROM Student 
    INNER JOIN Exam ON Student.Id_Student = Exam.Id_Student WHERE Student.NameGroup = @Group
GROUP BY Student.NameGroup, Student.Id_Student, Student.FIO 
ORDER BY avg_mark DESC
OPEN mark_cursor
WHILE @n < 19 AND @@FETCH_STATUS = 0
BEGIN
    SET @n += 1
    IF @Gr = @Group INSERT INTO @TOP_STUDENTS VALUES (@fio, @res)
    FETCH NEXT FROM mark_cursor INTO @fio, @Gr, @res
END
FETCH FIRST FROM mark_cursor INTO @fio, @Gr, @res
SELECT * FROM @TOP_STUDENTS
CLOSE mark_cursor
DEALLOCATE mark_cursor
